author: Steve Harris
date: 2014-12-18
subject: How to make an R package

Readme
======


Todo
====


Log
===
2014-12-18
- file created

I am going to follow the instructions provided by Hilary Parker at [Not So Standard Deviations](http://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/).

Here goes.

## Set up

```{r setup, eval=FALSE}
# Don't evaluate this as the `create` will fail because the library already exits
library(devtools)
library(roxygen2)
setwd("/Users/steve/usr/lib/R-stuff")
create("datascibc")
```

The `create` command makes a subdirectory for the new package. Inside this, there is a file called `DESCRIPTION.R`. I added my contact details, and the package description here (pasted below).

```{r description, eval=FALSE}
Package: datascibc
Title: Miscellaneous helper functions 
Version: 0.1
Authors@R: "Steve Harris <git@steveharris.me> [aut, cre]"
Description: Miscellaneous helper functions, but with a longer term plan to share these functions with the other members of @datascibc
Depends: R (>= 3.1.2)
License: What license is it under? Don't know!
LazyData: true

```


There is also a `datascibc\R` subdirectory. This is where you need to add the R functions you want to save. For example, in a file called `lookfor.R` save the following.

```{r fun_lookfor, eval=FALSE}
# R version of lookfor: `names(data)[grep('pattern',names(data))]`
lookfor <- function(d,p) names(d)[grep(p,names(d))]
```

Not very easy to read is it. So now you are required to add some documentation via `roxygen2` with detailed instructions [here](https://github.com/klutometis/roxygen#roxygen2). In fact, the documentation required for a package is more complicated, and it is roxygen2 that is making this process simple.

Here is the file with comments added.

```{r fun_lookfor2, eval=FALSE}
#' R version of the stata lookfor function
#'
#' This will try to find a variable when you can't remember its exact name
#' @param string_to_find This is the string you wish to find Defaults to 'id'.
#' @keywords stata
#' @export
#' @examples
#' lookfor_function()
lookfor <- function(data=wdt,string_to_find) names(data)[grep(string_to_find,names(data))]
```

Now process the documentation

```{r documentation, eval=FALSE}
setwd("./datascibc")
document()
setwd("../")
```

We should be done, and I can now install my package.

```{r prep_install, echo=FALSE, include=FALSE}
# R markdown seems to run too fast for the next step to work
install("datascibc", quick=TRUE)
library(datascibc)
```

```{r install, eval=TRUE}
install("datascibc")
# Let's see if R can print the new function
lookfor
# Let's test this
test_data <- data.frame(id=c(1:10), x=seq(1, 100, 10))
test_data
lookfor("id", test_data)
# Hooray!
```









